import requests
import json
import pandas as pd

# Ваш ключ API
api_key = "rudcgu3317"

# Параметры запроса
params = {
    "q": "типография полиграфия",
    "region_id": 38,  # ID Новосибирска
    "fields": "items.contact_groups,items.links",
    "key": api_key
}

# URL API
api_url = "https://catalog.api.2gis.com/3.0/items"

def parse_2gis_api():
    try:
        response = requests.get(api_url, params=params)
        response.raise_for_status()
        data = response.json()

        companies = []
        for item in data.get("result", {}).get("items", []):
            # Извлекаем сайт из поля links
            website = "Не найдено"
            if "links" in item:
                for link in item["links"]:
                    if link["type"] == "website":
                        website = link["value"]
                        break
            companies.append({"website": website})

        return companies

    except requests.RequestException as e:
        print(f"Ошибка при запросе к API: {e}")
        return []

# Парсинг данных
company_data = parse_2gis_api()

# а) Сохранение в JSON
with open("2gis_typography.json", "w", encoding='utf-8') as json_file:
    json.dump(company_data, json_file, ensure_ascii=False, indent=4)
print("Данные сохранены в '2gis_typography.json'")

# б) Сохранение в XLSX
df = pd.DataFrame(company_data)
df.to_excel("2gis_typography.xlsx", index=False, engine='openpyxl')
print("Данные сохранены в '2gis_typography.xlsx'")